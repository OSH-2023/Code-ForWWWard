# 结题报告 Code-ForWWWard

**小组成员**

* 王润泽 PB21020685
* 王道宇 PB21030794
* 封霁芩 PB21111670
* 陈应豪 PB21000117
* 王昱     PB21030814





## 1 项目简介

本项目旨在基于现有的零拷贝技术，对现有的ROS2机器人操作系统进行实时性优化，实现数据传输的超低延迟，对多个物理中断的实时沟通问题进行解决，并希望以此作为对万物互联时代多机协同工作实时沟通与协同问题的一次积极实践。

## 2 项目背景

### 2.1 ROS2

#### 2.1.1 ROS 简介

ROS(Robot Operating Systems)是一个机器人领域的元操作系统，是一个分布式的通信框架，能够帮助进程间更方便地实现通信，协调一个机器人的各个部件或多个机器人组成的机器人集群完成任务。

![](image/1.png)

#### 2.1.2 ROS2 的通信机制

为了达到简化机器人开发的设计目的，ROS 开发了一整套通讯机制，包括话题，服务参数和动作。为了将各个机器人节点连接起来并实现通信，ROS 引入了 `ROS Master`节点，所有节点的通讯必须经过这个主节点。

![](image/3.gif)

#### 2.1.3 ROS vs ROS2

ROS1具备以下不足：

- 仅支持Linux系统
- 基于TCP/IP的通信方式，点对点的分布式通信机制，实时性差，系统开销大
- 依赖于ROS master管理所有节点的通讯，稳定性差
- 对Python3支持不友好

ROS2对此做出了改进：

- 支持Linux、Windows、Mac OS、嵌入式RTOS等，跨平台特性得到改善
- 引入DDS通信协议，可通过零拷贝的方式传递消息，节约CPU、内存的资源，实时性得到了很大的提升
- 去中心化：去除了ROS master中心节点管理器，节点地位平等，可以一对一、一对多、多对多互相通信，稳定性、可靠性得到了很大的提高
- 支持Python3

改进前后ROS的架构如下：

![](image/2.png)

#### 2.1.4 ROS2 实时性的缺陷

**`Linux`内核的实时性不足**：

- `Linux`内核的调度机制并不是针对实时性的，这使得`Linux`无法提供完全实时的响应。 `ROS2`使用通用的通信框架，它的设计并不是专门为实时性而优化的。`ROS2`使用`DDS`作为通信协议，`DDS`是一种高度灵活的通信协议，但其对实时性能的支持并不足够强大。

**`ROS2`的性能瓶颈**

- **CPU资源占用**：需要占用`CPU`资源进行消息的序列化、反序列化、传输等操作，如果`CPU`资源占用过高，则会影响实时性能
- **内存管理**：涉及到内存的动态分配和释放，如果内存管理不当，会导致内存碎片问题，从而影响实时性能

### 2.2 零拷贝技术





## 3 项目设计

### 3.1 项目整体架构



### 3.2 技术路线



### 3.3 设计难点

### DCA放弃使用

* `DCA`关不掉，设备支持`DCA`模块即默认打开，如果关掉则会导致与它相关的依赖无法工作。
  ![](image/wy_pic1.png)
  * 我们曾尝试关掉`DCA`模块，结果导致服务器上连包也下载不了，最终只能去实验室重装服务器系统，重新配置服务器

* `grub`文件改内核选项，保存不了也运行不了
* `dca.h`头文件用户态无法调用，只能使用内核态调用。而内核态代码调试困难

### 服务器配置困难

* **帮助我们配置的学长**说这个服务器是很早之前的，服务器本身存在一点问题
* 由于网络并不是我们项目的重点，而配置服务器的`ssh`需要一些网络知识，这导致我们所作的无用功增加，浪费了时间，拖延了项目的进展

### ROS2环境搭建以及零拷贝的实现

* 由于`DCA`宣告失败，我们尝试使用`zero-copy`来优化通信。经过多番尝试，我们利用`iceoryx`这一个中间件，通过调用和改写实现了一个`zero-copy`的`demo`程序



## 4 实验过程

### 4.1 ROS2部署

### 4.2 中间件部署

### 



## 5 实验结果



## 6 总结





## 参考文献
