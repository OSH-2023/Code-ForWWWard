# 实时操作系统调研



### 什么是RTOS？

**来自维基百科：**

> **实时操作系统**（Real-time operating system, RTOS），又称**即时操作系统**，它会按照排序执行、管理系统资源，并为开发应用程序提供一致的基础。
>
> 实时操作系统与一般的[操作系统](https://zh.wikipedia.org/wiki/操作系统)相比，最大的特色就是“[实时性](https://zh.wikipedia.org/wiki/实时计算)”[[1\]](https://zh.wikipedia.org/wiki/实时操作系统#cite_note-1)，如果有一个任务需要执行，实时操作系统会马上（在较短时间内）执行该任务，不会有较长的延时。这种特性保证了各个任务的及时执行。
>
> 设计实时操作系统的首要目标不是高的[吞吐量](https://zh.wikipedia.org/wiki/吞吐量)，而是保证任务在特定时间内完成，因此衡量一个实时操作系统坚固性的重要指标，是系统从接收一个任务，到完成该任务所需的时间，其时间的变化称为[抖动](https://zh.wikipedia.org/wiki/实时计算)。可以依抖动将实时操作系统分为两种：硬实时操作系统及软实时操作系统，硬实时操作系统比软实时操作系统有更少的抖动：
>
> - 硬实时操作系统**必须**使任务在确定的时间内完成。
> - 软实时操作系统能让**绝大多数**任务在确定时间内完成。[[2\]](https://zh.wikipedia.org/wiki/实时操作系统#cite_note-2)
>
> 实时操作系统与一般的操作系统有着不同的[调度](https://zh.wikipedia.org/wiki/排程)算法。普通的操作系统的调度器对于线程优先级等方面的处理更加灵活；而实时操作系统追求最小的[中断延时](https://zh.wikipedia.org/w/index.php?title=中断延时&action=edit&redlink=1)和[线程切换延时](https://zh.wikipedia.org/wiki/上下文交換)。[[3\]](https://zh.wikipedia.org/wiki/实时操作系统#cite_note-3)

### **RTOS的主要特点：**

##### (1) 高精度计时系统

RTOS具有实时性、可靠性的特点，在发生外界事件或数据产生时，能够在给定的较短时间内完成响应并进行处理。计时精度是影响实时性的一个重要因素，在RTOS中，经常需要精确确定实时地操作某个设备或执行某个任务，或精确的计算一个时间函数。这些不仅依赖于一些硬件提供的时钟精度，也依赖于RTOS实现的高精度计时功能。

##### (2) 多级中断机制

一个RTOS通常需要处理多种外部信息或事件，但处理的紧迫程度有轻重缓急之分。有的必须立即作出反应，有的则可以延后处理。因此，需要建立多级中断嵌套处理机制，以确保对紧迫程度较高的实时事件进行及时响应和处理。

##### (3) 实时调度机制

在RTOS中包含一个实时的任务调度器，会严格按照优先级分配CPU时间，使之能够及时调度运行实时任务。处理机调度会涉及到两个进程之间的切换，只能在确保“安全切换”的时间点上进行，实时调度机制包括两个方面，一是在调度策略和算法上保证优先调度实时任务；二是建立更多“安全切换”时间点，保证及时调度实时任务。

### freeRTOS调研

**网站参考：**[FreeRTOS官方网站](https://www.freertos.org/zh-cn-cmn-s/index.html)

FreeRTOS是一个开源的实时操作系统内核，它专门用于嵌入式设备。它是由Richard Barry创建的，最初于2003年发布。 FreeRTOS具有非常小的内核尺寸和低延迟响应时间，它可以在各种微控制器上使用，并能够支持多个处理器架构。

**内核组成：**

1. 任务管理：FreeRTOS基于任务的概念来管理系统资源。它可以创建、删除、挂起、恢复和设置优先级等任务管理操作。
2. 调度器：FreeRTOS采用抢占式调度算法，可以根据任务的优先级自动进行任务切换。调度器会从就绪队列中选取最高优先级的任务执行，并在必要时切换到其他任务。
3. 信号量：FreeRTOS支持二元信号量、计数信号量和互斥信号量等多种信号量类型，用于线程间同步和资源共享。
4. 队列：FreeRTOS支持消息队列和邮件队列两种队列类型，用于实现任务之间的通信及数据传输。
5. 定时器：FreeRTOS提供了软件定时器和硬件定时器两种类型的定时器，用于实现周期性任务、超时处理等功能。
6. 堆管理：FreeRTOS提供堆管理功能，支持动态内存分配和释放。用户可以自定义堆大小和实现方式。
7. 中断服务程序：FreeRTOS允许在中断服务程序中调用一些RTOS API函数，以便在中断处理过程中完成一些必要的操作。

**优点：**

1. 简单易用：FreeRTOS的内核代码非常精简，易于理解和使用。它提供了一系列简单的API，可以方便地创建任务、信号量等。如果大作业考虑相关选题，上手难度较小。
2. 强大的功能扩展能力：FreeRTOS支持许多不同的可选组件，如TCP/IP协议栈、文件系统、USB驱动程序等，可以方便地扩展其功能。
3. 社区支持强大：FreeRTOS有一个庞大的社区，提供了许多例子和文档，帮助开发人员学习和使用FreeRTOS。这样比较方便上手学习。

**缺点：**

1. 缺乏完整的图形用户界面(GUI)支持：FreeRTOS主要面向嵌入式设备开发，缺乏完整的GUI支持。这可能会使某些应用程序的开发和调试变得更加困难。
2. 硬实时性限制：FreeRTOS的硬实时性能受到一定限制，因为任务切换和中断处理可能需要一定的时间。如果应用程序对硬实时性能有严格要求，那么可能需要选择其他更适合的实时操作系统。

### 往届RTOS项目调研

#### x-NooBirds调研

> 本项目旨在基于现有的实时操作系统技术，借助仿真模拟平台和高还原度的可编程车，对多个物理终端的**实时沟通和调度问题**进行解决，并希望以此作为对万物互联纪元智能交通系统的重要课题——多运载终端实时沟通和协同问题的一次积极实践。

往届项目采用在服务器树莓派上部署实时 Linux 系统。实时 Linux 通过在内核代码中加入**更多可被抢占的时间点**、更改**内核调度策略**，来实现实时调度，将原生 Linux 转化为实时系统。采用 PiRacer AI Kit 遥控车来作为实验载体。

该项目采用**宏观调度算法**和**微观调度算法**，前者使得每一个十字路口的峰值载流量能够降低以及单一道路上的车速能保持相对一致，后者试图解决小车在十字路口相遇时的路线规划问题。本次实验修改现成的 RVO2 仓库进行测试。

#### x_do_our_best调研

> 随着智能硬件、物联网行业的迅猛发展, 嵌入式系统在各个领域都得到了广泛的应用。嵌入式操作系统可以帮助嵌入式设备更好地完成任务的调度，从而更高效地完成任务。目前，嵌入式系统正在向着功能日趋复杂，多机联合，分布式等方面发展。这些复杂的应用需要有较大的运算量，而传统的单片机是无法完成这些复杂的计算的。同时，要想实现复杂的功能，裸机编程也会因为过于困难且容易出错而难以实现。
>
> 鉴于以上这些背景，我们决定使用嵌入式操作系统RT_thread搭配ros的方式，来实现一个兼顾实时性和计算复杂性，符合当今嵌入式系统发展趋势的系统。

该项目组的主要思路是在stm32上运行RT-thread，并在RT-thread上运行ros的软件包rosserial，作为ros的从节点。rosserial可以与主节点之间通过TCP或串口等建立联系。然后通过Publisher和Subscriber进行消息的传递。

该项目利用了RTOS硬实时性，实时性好的优势，同时利用ros把复杂计算传回pc端进行，有执行复杂计算任务的能力。充分发挥了实时操作系统的优势。

### **调研结论**

1. 现有RTOS系统的直接优化较为困难。freeRTOS等操作系统内核精简，难以做出创新性优化。
2. 可以基于现有实时操作系统，做应用层上的创新。如2022年小车项目，基于现有的实时操作系统技术，借助仿真模拟平台和高还原度的可编程车，对多个物理终端的实时沟通和调度问题进行了一定程度上的解决。

### 可行的调研方向

1. **调度算法**：RTOS中的调度算法直接影响到任务的响应时间和处理能力，因此对调度算法的深入研究可以提高RTOS的性能和效率。
2. **内存管理**：RTOS需要合理地分配和管理内存资源，在高并发、大数据量的应用场景下尤为重要。研究内存管理算法能够提高RTOS的稳定性和可靠性。
3. **通信机制**：RTOS中的进程间通信是保证系统协同运行的关键，了解并优化通信机制能够提高RTOS的通信效率和可靠性。

### 关于为什么不选择RTOS
1.在大致阅读FreeRTOS的源代码后，发现FreeRTOS已经是一个完整，优化较为成功的实时操作系统，按照我们现有的水平，可能不太能在其中做出较为优秀的改进。
2.RTOS的可玩性较弱，在了解到ROS后的可玩性后，我们小组暂时投入研究ROS的一系列应用。
