# ROS2基于DCA技术优化实时性的可行性报告

## 目录

## 小组成员
* 王润泽
* 王道宇
* 封霁芩
* 陈应豪
* 王昱
## 项目背景
### ROS2通信框架在Linux系统上实时性的瓶颈
* `Linux`**内核的实时性不足**：`Linux`内核的调度机制并不是针对实时性的，这使得`Linux`无法提供完全实时的响应
* `ROS2`使用通用的通信框架，它的设计并不是专门为实时性而优化的。`ROS2`使用`DDS`作为通信协议，`DDS`是一种高度灵活的通信协议，但其对实时性能的支持并不足够强大

* **CPU资源占用**：需要占用CPU资源进行消息的序列化、反序列化、传输等操作，如果CPU资源占用过高，则会影响实时性能
* **内存管理**：涉及到内存的动态分配和释放，如果内存管理不当，会导致内存碎片问题，从而影响实时性能

> 因此我们需要引入DCA技术来大大提高ROS2的实时性

### DCA的优势以及对ROS2的性能改善
* `DCA`的优势
  * `DCA`显著减少接收密集型网络I/O的**内存延迟和内存带宽**
  * `DCA`可以减少很大一部分的`cache misses`
  * `DCA`技术通过将远程内存数据直接预取到处理器的缓存中，避免了传统访问模式下频繁的内存访问，从而减少了CPU与内存之间的数据传输和访问延迟，提高了**系统的吞吐量和响应速度**。与传统`DMA（Direct Memory Access，直接内存访问）`技术相比，`DCA`技术可以实现更高的效率和性能，同时还能降低系统的负载和功耗

* 通过直接访问CPU缓存中的数据，减少CPU与内存之间的数据传输时间，从而减少了CPU资源的占用。



## 代码实现

### 调用DCA的基本步骤及相关的头文件
>  [dca.h头文件](https://github.com/torvalds/linux/blob/master/include/linux/dca.h)
>
>  下面是一些重要的函数、结构体

```C++
//注册一个DCA提供者的函数
int register_dca_provider(struct dca_provider *dca, struct device *dev);
//注销一个DCA提供者的函数
void unregister_dca_provider(struct dca_provider *dca, struct device *dev);
//结构体
struct dca_provider {
	struct list_head	node;
	const struct dca_ops	*ops;
	struct device 		*cd;
	int			 id;
};

struct dca_domain {
	struct list_head	node;
	struct list_head	dca_providers;
	struct pci_bus		*pci_rc;
};

struct dca_ops {
	int	(*add_requester)    (struct dca_provider *, struct device *);
	int	(*remove_requester) (struct dca_provider *, struct device *);
	u8	(*get_tag)	    (struct dca_provider *, struct device *,
				     int cpu);
	int	(*dev_managed)      (struct dca_provider *, struct device *);
};
//添加一个DCA请求的函数
int dca_add_requester(struct device *dev);
//删除一个DCA请求的函数
int dca_remove_requester(struct device *dev);
```

* **引入头文件**：通常需要引入相关的系统或库文件的头文件，以便在代码中调用相应的函数或接口。例如，在Linux系统中，可以引入**<linux/dca.h>头文件**来使用DCA相关的函数和宏定义。

* **初始化DCA**：需要在程序启动时进行DCA的初始化，以确保DCA功能可以正常使用。通常需要调用相关的函数或接口，例如在Linux系统中，可以使用**dca_sysfs_init()函数**来初始化DCA。

* **配置DCA**：需要根据具体的应用场景和数据访问模式来配置DCA，例如设置预取的数据大小和预取的地址等参数。通常需要使用相应的函数或接口来进行配置，例如在Linux系统中，可以使用**dca3_config()函数**来配置DCA。

* **调用DCA**：在程序运行时，可以使用相应的函数或接口来调用DCA功能，以实现预取数据到缓存中。例如在Linux系统中，可以使用**dca3_get_tag()函数**来执行DCA操作。




***
# 下面是可行性报告的框架
## 1. 背景介绍
- ROS2通信框架及其应用
- 实时性和低延迟通信的需求
- DCA技术介绍及其优势
- NIC与CPU交互

## 2. ROS2通信框架中存在的性能瓶颈
- 运行在Linux上降低了实时性
- ROS2通信框架中可能出现的性能瓶颈
- ROS2通信框架中性能瓶颈与实时性的关系

## 3. DCA技术在ROS2中的应用
- 为什么只能是intel不能是amd
- DCA技术与ROS2通信框架的结合
- DCA技术对ROS2实时性的影响
- DCA技术在ROS2通信中的优化效果
## 4. 代码实现
- C头文件
- 相关函数介绍 

## 5. 硬件情况
## 6. 实验与评估方法
可能使用的评估方案
## 7. 结论
- 主要结论

## 8. 参考文献
